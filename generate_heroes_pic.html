<!DOCTYPE html>
<html style="width:100%;height:100%;"><head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">
</head>
<body style="margin:0px;width:100%;height:100%;">
</body>
	<script>
		const DOTA2_HEROES_ICON_PATH = 'https://cdn.cloudflare.steamstatic.com/apps/dota2/images/dota_react/heroes/';
		const IMG_HEIGHT = 144;
		const IMG_WIDTH = 256;
		async function loadImage(url, elem) {
			return new Promise((resolve, reject) => {
				elem.onload = () => resolve(elem);
				elem.onerror = () => resolve(elem);
				//elem.onerror = reject;
				elem.src = url;
			});
		}
		async function getImage(heroName) {
			let image = document.createElement('img');
			image.width = IMG_WIDTH;
			image.height = IMG_HEIGHT;
			document.body.append(image);
			return await loadImage(DOTA2_HEROES_ICON_PATH + heroName + '.png', image);
		}
		async function generateHeroes() {
			let css = '';
			const response = await fetch('https://dota2content.dotaloadout.com/generated/heroes.json');
			if (!response) {
				return;
			}

			const json = await response.json();
			if (!json) {
				return;
			}

			const heroPerOrderId = new Map();
			let heroCount = 0
			for (let hero of json.heroes) {
				heroPerOrderId.set(Number(hero.HeroOrderID), hero);
				++heroCount;
			}

			console.log('Hero count', heroCount);

			let canvas = document.createElement('canvas');
			document.body.append(canvas);
			canvas.width = IMG_WIDTH;
			canvas.height = IMG_HEIGHT * heroCount;//remove ward and courier
			let ctx = canvas.getContext('2d');
			let dy = 0;
			css += '.hero-icon{\nbackground-image:url(\'./img/heroes.jpeg\');\nheight: 100%;\nwidth: 100%;\nbackground-size: 100% '+ (canvas.height / 2) +'px;\nbackground-repeat: no-repeat;\n}\n';


			for (let heroOrderId = 1; heroOrderId <= heroCount; ++heroOrderId) {
				const heroJSON = heroPerOrderId.get(heroOrderId);
				let heroName = heroJSON.ID.replace('npc_dota_hero_', '');
				if (heroName == 'courier') continue;
				if (heroName == 'ward') continue;
				console.error(heroName);
				let image = await getImage(heroName);
				ctx.drawImage(image, 0, dy, IMG_WIDTH, IMG_HEIGHT);

				css += '.hero-icon-' + heroName + '{\n';
				css += 'background-position-y:-'+ (dy / 2) +'px;\n';
				css += '}\n';
				dy += IMG_HEIGHT;

			}
		}
		generateHeroes();
	</script>
</html>
